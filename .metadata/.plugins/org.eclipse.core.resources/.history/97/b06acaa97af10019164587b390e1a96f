$(function() {
	var contextPath = $(document.body).attr("data-context-path");

	$("#errorMessage").toggle();
    $('input').next().remove();
	$(".add-new-category").on('click','.nav-link',function(){

        $('input').val('');
	    $('input').next().remove();
	        
    });
	$('#buttonSubmit').click(function(e) {
		   
	    e.preventDefault();

	    var modal = $("#addCategory");
  	    
	    $.post({
	       url : contextPath+'/ajax/category/add-category',
	       data : $('form[name="addCategory"]').serialize(),
	       success : function(res) {
    	   $('.addSuccessMessage').hide();
	    	   console.log("getting here");
	          if(res.validated){
		    	  $("#errorMessage").fadeOut();
		    	  modal.modal('toggle');

	        	  $('.addSuccessMessage').show();
	        	  $('.addSuccessMessage p').html(res.customMessage); 
	              $('#categoryTable').append(categoryTemplate(res.data));
	          
	          }else{
	        	      $('input').next().remove();
		              $.each(res.errorMessages,function(key,value){
		            	  $('input[name='+key+']').after('<span class="text-danger">'+value+'</span>');
		              });
	          }
	       }
	    , error:function(error){
	    	console.log(error);
	    }
	    
	    })
	 });
	$(document).on('click','.delete',function(e) {
		   
	    e.preventDefault();
  	    
	    var id = $(this).attr("id");
	    
	    $.get({
	       url : contextPath+'/ajax/category/delete-category?id='+id,
	       success : function(res) {

        	   $('.deleteSuccessMessage').hide();
	    	   console.log("getting here");
	    	   
	          if(res.validated){
		    	  $("#errorMessage").fadeOut();
	              $('#categoryRow'+id).remove();
	        	  $('.deleteSuccessMessage').show();
	        	  $('.deleteSuccessMessage p').html(res.customMessage);
	              
	          }else{
	        	  $("#errorMessage").html(res.customMessage);
		    	  $("#errorMessage").fadeIn();
	        	  $('.deleteFailedMessage').show();
	        	  $('.deleteFailedMessage p').html(res.customMessage);
	          }
	       }
	    , error:function(error){
	    	console.log(error);
	    }
	    
	    })
	 });
    
});